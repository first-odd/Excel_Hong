import xbot
from xbot import print, sleep
from . import package
import xbot_visual
import time
import os
import sys
import glob
import random
import re
import win32com
from win32com.client import Dispatch

def main(args):
    pass

def 注入宏():
    宏代码=        '''Sub 银行日记账数据清洗宏()
    Cells.Select
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    Selection.UnMerge
    Columns("E:E").Select
    Selection.TextToColumns Destination:=Range("E1"), DataType:=xlDelimited, _
        TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
        Semicolon:=False, Comma:=False, Space:=False, Other:=False, FieldInfo _
        :=Array(1, 1), TrailingMinusNumbers:=True
    Selection.Insert Shift:=xlToRight, CopyOrigin:=xlFormatFromLeftOrAbove
    Selection.NumberFormatLocal = "0.00_ "
    Range("E6").Select
    Application.CutCopyMode = False
    ActiveCell.FormulaR1C1 = "=RC[-1]&RC[1]"
    Range("E6").Select
    Selection.AutoFill Destination:=Range("E6:E20485")
    Range("E6:E20485").Select
    Columns("E:E").Select
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Range("D:D,F:F").Select
    Range("F1").Activate
    Application.CutCopyMode = False
    Selection.Delete Shift:=xlToLeft
    Columns("B:C").Select
    Range("C1").Activate
    Selection.Delete Shift:=xlToLeft
    Columns("A:A").Select
    Selection.NumberFormatLocal = "yyyy-mm-dd;@"
    Columns("D:D").Select
    Selection.Insert Shift:=xlToRight, CopyOrigin:=xlFormatFromLeftOrAbove
    Selection.Insert Shift:=xlToRight, CopyOrigin:=xlFormatFromLeftOrAbove
    Columns("D:E").Select
    Selection.NumberFormatLocal = "G/通用格式"
    Range("E6").Select
    ActiveCell.FormulaR1C1 = "=RC[-2]&"":"""
    Range("E6").Select
    Selection.AutoFill Destination:=Range("E6:E20485")
    Range("E6:E20485").Select
    Columns("E:E").Select
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Columns("E:E").Select
    Application.CutCopyMode = False
    Selection.Copy
    Range("C1").Select
    ActiveSheet.Paste
    Columns("E:E").Select
    Application.CutCopyMode = False
    Selection.Delete Shift:=xlToLeft
    Columns("D:D").Select
    Selection.Insert Shift:=xlToRight, CopyOrigin:=xlFormatFromLeftOrAbove
    Range("D6").Select
    ActiveCell.FormulaR1C1 = "=LEFT(RC[-1],FIND("":"",RC[-1])-1)"
    Range("E6").Select
    ActiveCell.FormulaR1C1 = "=MID(RC[-2],FIND("":"",RC[-2])+1,255)"
    Range("D6:E6").Select
    Selection.AutoFill Destination:=Range("D6:E20485")
    Range("D6:E20485").Select
    
        Columns("D:E").Select
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Columns("C:C").Select
    Application.CutCopyMode = False
    Selection.Delete Shift:=xlToLeft
    Columns("E:E").Select
    Selection.Insert Shift:=xlToRight, CopyOrigin:=xlFormatFromLeftOrAbove
    Range("E6").Select
    ActiveCell.FormulaR1C1 = "=LEFT(RC[-1],FIND("":"",RC[-1])-1)"
    Range("E6").Select
    Selection.AutoFill Destination:=Range("E6:E20485")
    Range("E6:E20485").Select
    Columns("E:E").Select
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Selection.Replace What:="#VALUE!", Replacement:="", LookAt:=xlPart, _
        SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False, FormulaVersion:=xlReplaceFormula2
    Columns("D:D").Select
    Application.CutCopyMode = False
    Selection.Delete Shift:=xlToLeft
    Range("D5").Select
    ActiveWindow.SmallScroll ToRight:=-27
    Columns("B:B").Select
    Selection.Replace What:="记账凭证", Replacement:="[记]", LookAt:=xlPart, _
        SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False, FormulaVersion:=xlReplaceFormula2
    Range("C5").Select
    ActiveCell.FormulaR1C1 = "对方单位"
    Range("D5").Select
    ActiveCell.FormulaR1C1 = "摘要"
    Columns("A:A").Select
    Selection.Copy
    ActiveWindow.SmallScroll ToRight:=3
    Columns("H:H").Select
    Selection.Insert Shift:=xlToRight
    Range("H1:H4").Select
    Range("H4").Activate
    Application.CutCopyMode = False
    Selection.ClearContents
    Range("F8").Select
    ActiveWindow.SmallScroll ToRight:=-6
    Columns("C:C").Select
    Selection.Cut
    Columns("F:F").Select
    Selection.Insert Shift:=xlToRight
    Range("A1:J20485").Select
    Range("D7").Activate
    Selection.AutoFilter
    Range("F2").Select
    ActiveWindow.SmallScroll ToRight:=3
    Range("F:G,J:J").Select
    Range("J1").Activate
    Selection.Style = "Comma"
    Range("G8").Select
    ActiveWindow.SmallScroll ToRight:=-27
    ActiveWindow.SmallScroll Down:=-9
End Sub'''

    sys.coinit_flags = 0
    com_instance = Dispatch("Excel.Application")
    com_instance.Visible = True
    com_instance.DisplayAlerts = False
    objworkbook = com_instance.Workbooks(1)
    xlmodule02 = objworkbook.VBProject.VBComponents.Add(1)
    xlmodule02.CodeModule.AddFromString(宏代码.strip())#注入代码
    com_instance.Run("银行日记账数据清洗宏")#执行代码
